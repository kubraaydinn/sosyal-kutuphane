{% extends "base.html" %}
{% block title %}{{ profile_user.username }} - Tüm Aktiviteler{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-3">
    {{ profile_user.username }} - Tüm Aktiviteler
  </h3>

  {% if activities_page.items %}
    {% for act in activities_page.items %}
      <div class="activity-card mb-3">
        <div class="activity-header d-flex align-items-center">
          {% set avatar_src = act.user.avatar_url or 'https://i.pravatar.cc/150?u=' ~ act.user.id %}
          <div class="user-avatar"
               style="background-image: url('{{ avatar_src }}');"></div>
          <div class="ms-2">
            <a href="{{ url_for('profile.view_profile', username=act.user.username) }}"
               class="username">
              {{ act.user.username }}
            </a>
            <div class="activity-meta small text-muted">
              {{ act.created_at.strftime("%d.%m.%Y %H:%M") }}
            </div>
          </div>
        </div>

        {% if act.content %}
        <div class="activity-body d-flex mt-2">
          <a href="{{ url_for('content.detail', content_id=act.content.id) }}"
             class="poster-wrapper">
            {% if act.content.poster_url %}
              <img src="{{ act.content.poster_url }}"
                   alt="{{ act.content.title }}"
                   class="activity-poster">
            {% else %}
              <div class="activity-poster placeholder-poster">Kapak yok</div>
            {% endif %}
          </a>
          <div class="ms-2">
            <div class="fw-semibold">{{ act.content.title }}</div>
            <div class="small text-muted">
              {% if act.activity_type == "rating" %}
                Puan verdi.
              {% elif act.activity_type == "review" %}
                Yorum yaptı.
              {% elif act.activity_type == "list_add" %}
                Listeye ekledi.
              {% endif %}
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    {% endfor %}

    {# Sayfalama #}
    <nav aria-label="Aktivite sayfalama" class="mt-3">
      <ul class="pagination justify-content-center">
        {% if activities_page.has_prev %}
          <li class="page-item">
            <a class="page-link"
               href="{{ url_for('profile.view_all_activities',
                                username=profile_user.username,
                                page=activities_page.prev_num) }}">
              Önceki
            </a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <span class="page-link">Önceki</span>
          </li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">
            Sayfa {{ activities_page.page }} / {{ activities_page.pages }}
          </span>
        </li>

        {% if activities_page.has_next %}
          <li class="page-item">
            <a class="page-link"
               href="{{ url_for('profile.view_all_activities',
                                username=profile_user.username,
                                page=activities_page.next_num) }}">
              Sonraki
            </a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <span class="page-link">Sonraki</span>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% else %}
    <p class="text-muted">Bu kullanıcı için aktivite bulunamadı.</p>
  {% endif %}

  <div class="mt-3">
    <a href="{{ url_for('profile.view_profile', username=profile_user.username) }}"
       class="btn btn-outline-secondary btn-sm">
      ← Profile geri dön
    </a>
  </div>
</div>
{% endblock %}
